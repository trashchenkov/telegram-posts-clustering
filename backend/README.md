# Telegram Posts Aggregator - Backend

Python backend –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ—Å—Ç–æ–≤ –∏–∑ Telegram –∫–∞–Ω–∞–ª–æ–≤ —Å –≥–∏–±—Ä–∏–¥–Ω–æ–π –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ embeddings –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–†–µ–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ Telegram** —á–µ—Ä–µ–∑ HTTP –∏ snscrape (–±–µ–∑ API –∫–ª—é—á–µ–π)
- **–ì–∏–±—Ä–∏–¥–Ω–∞—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è**: sentence-transformers + K-means + LLM naming
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ** –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ (2-8)
- **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã**: OpenAI, Anthropic, Google Gemini, Ollama
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º concurrent –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** —á–µ—Ä–µ–∑ —Ñ–∞–π–ª—ã –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **REST API** —Å –∞–≤—Ç–æ–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π
- **CORS –ø–æ–¥–¥–µ—Ä–∂–∫–∞** –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

## üß† –ê–ª–≥–æ—Ä–∏—Ç–º –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏

### –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥
1. **Embeddings**: sentence-transformers/all-MiniLM-L6-v2 –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ k**: silhouette score –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
3. **K-means**: –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è embeddings —Å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º k
4. **LLM naming**: —É–º–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ OpenAI/Anthropic/Gemini
5. **Fallback**: keyword-based –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–µ–π

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
```python
def _find_optimal_clusters(self, embeddings, min_clusters=2, max_clusters=8):
    # –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º k –æ—Ç 2 –¥–æ 8
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º silhouette_score –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
    # –í—ã–±–∏—Ä–∞–µ–º k —Å –ª—É—á—à–∏–º score
```

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
python -m venv venv
source venv/bin/activate  # –ù–∞ Windows: venv\Scripts\activate
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
pip install -r requirements.txt
```

**–û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- `sentence-transformers==4.1.0` - –¥–ª—è embeddings
- `scikit-learn==1.3.2` - –¥–ª—è K-means –∏ silhouette score
- `openai==1.82.0` - –¥–ª—è LLM naming
- `torch==2.7.0` - –¥–ª—è sentence-transformers
- `numpy==1.26.4` - –¥–ª—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `env.example` –≤ `.env` –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
```bash
cp env.example .env
```

### 4. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
```bash
source venv/bin/activate
python main.py
```

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:**
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# –∏–ª–∏
venv\Scripts\activate     # Windows
```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
```bash
pip install -r requirements.txt
```

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
```bash
cp env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

```env
# LLM Provider –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏–π –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
LLM_PROVIDER=openai  # openai, anthropic, gemini, ollama, none

# API Keys (–≤—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π)
OPENAI_API_KEY=your_key_here
OPENAI_MODEL=gpt-4.1-nano-2025-04-14

ANTHROPIC_API_KEY=your_key_here  
ANTHROPIC_MODEL=claude-3-haiku-20240307

GEMINI_API_KEY=your_key_here
GEMINI_MODEL=gemini-pro

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
MIN_CLUSTERS=2
MAX_CLUSTERS=8

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
POSTS_LIMIT_PER_CHANNEL=50
HOURS_BACK=24
```

### –°–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤ (config/channels.txt)

–û–¥–∏–Ω –∫–∞–Ω–∞–ª –Ω–∞ —Å—Ç—Ä–æ–∫—É, –±–µ–∑ —Å–∏–º–≤–æ–ª–∞ @:
```
seeallochnaya
data_secrets
tsingular
```

## üèÉ –ó–∞–ø—É—Å–∫

```bash
# –ò–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ backend
python main.py
```

API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8000

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: http://localhost:8000/docs
- **Health check**: http://localhost:8000/api/v1/health

## üì° API Endpoints

### GET /api/v1/health
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞
```json
{
  "status": "ok",
  "llm_provider": "openai",
  "llm_available": true,
  "channels_count": 49
}
```

### POST /api/v1/posts
–ü–æ–ª—É—á–µ–Ω–∏–µ –∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤
```json
{
  "channels": ["seeallochnaya", "data_secrets"],
  "hours_back": 24
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "posts": [
    {
      "id": "seeallochnaya_1234567890_http_0",
      "channelName": "seeallochnaya",
      "publicationDateTime": "2024-01-15T10:30:00",
      "postLink": "https://t.me/seeallochnaya/123",
      "postText": "–ù–æ–≤–∞—è –º–æ–¥–µ–ª—å –æ—Ç OpenAI...",
      "hasMedia": false,
      "clusterName": "AI –º–æ–¥–µ–ª–∏ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞"
    }
  ],
  "total_count": 10,
  "processing_time_seconds": 2.55,
  "clusters_created": 2
}
```

### GET /api/v1/channels
–°–ø–∏—Å–æ–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö –∫–∞–Ω–∞–ª–æ–≤

### GET /api/v1/providers
–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞—Ö

## üîß LLM –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã

### OpenAI
```env
LLM_PROVIDER=openai
OPENAI_API_KEY=sk-...
OPENAI_MODEL=gpt-4.1-nano-2025-04-14
```

### Anthropic Claude
```env
LLM_PROVIDER=anthropic
ANTHROPIC_API_KEY=sk-ant-...
ANTHROPIC_MODEL=claude-3-sonnet-20240229
```

### Google Gemini
```env
LLM_PROVIDER=gemini
GEMINI_API_KEY=...
GEMINI_MODEL=gemini-pro
```

### Ollama (–ª–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏)
```env
LLM_PROVIDER=ollama
OLLAMA_BASE_URL=http://localhost:11434
OLLAMA_MODEL=llama2
```

### –ë–µ–∑ LLM (—Ç–æ–ª—å–∫–æ embeddings)
```env
LLM_PROVIDER=none
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
backend/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îî‚îÄ‚îÄ routes.py          # FastAPI —Ä–æ—É—Ç—ã
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ settings.py        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ channels.txt       # –°–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îî‚îÄ‚îÄ post.py           # Pydantic –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ telegram_parser.py # HTTP + snscrape –ø–∞—Ä—Å–∏–Ω–≥
‚îÇ   ‚îî‚îÄ‚îÄ clustering_service.py # –ì–∏–±—Ä–∏–¥–Ω–∞—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îî‚îÄ‚îÄ channel_loader.py  # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –∫–∞–Ω–∞–ª–æ–≤
‚îî‚îÄ‚îÄ main.py               # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
```

## üîç –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å —É—Ä–æ–≤–Ω–µ–º INFO. –õ–æ–≥–∏ –≤–∫–ª—é—á–∞—é—Ç:
- –ü—Ä–æ—Ü–µ—Å—Å –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–∞–Ω–∞–ª–æ–≤
- –ó–∞–≥—Ä—É–∑–∫–∞ embedding –º–æ–¥–µ–ª–∏
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ LLM
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –ø–æ—Å—Ç–∞–º

–ü—Ä–∏–º–µ—Ä –ª–æ–≥–æ–≤:
```
üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥–µ–ª—å –¥–ª—è embeddings...
‚úÖ Embedding –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞
üîÑ –ü–æ–ª—É—á–∞–µ–º embeddings –¥–ª—è 10 —Ç–µ–∫—Å—Ç–æ–≤...
‚úÖ Embeddings –ø–æ–ª—É—á–µ–Ω—ã: (10, 384)
üéØ –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤: 2 (score: 0.342)
‚úÖ –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞: 2 –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
ü§ñ –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ —É LLM...
‚úÖ LLM —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –Ω–∞–∑–≤–∞–Ω–∏—è: {0: "AI –≤–∏–¥–µ–æ –∏ –∑–≤—É–∫", 1: "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ –∏–≥—Ä—ã"}
```

## üö® –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- **sentence-transformers**: –¢—Ä–µ–±—É–µ—Ç ~1GB RAM –¥–ª—è –º–æ–¥–µ–ª–∏
- **snscrape**: –ú–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω Telegram –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
- **Rate limits**: LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –∏–º–µ—é—Ç –ª–∏–º–∏—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
- **Processing time**: –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ—Å—Ç–æ–≤ –∏ LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- **Concurrent requests**: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ MAX_CONCURRENT_REQUESTS

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º

Backend —Å–æ–≤–º–µ—Å—Ç–∏–º —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º React —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º. –ù—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–∏—Ç—å URL –≤ `services/postService.ts`:

```typescript
const API_BASE_URL = 'http://localhost:8000/api/v1';
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **HTTP –ø–∞—Ä—Å–µ—Ä** - –ø–∞—Ä—Å–∏–Ω–≥ Telegram –∫–∞–Ω–∞–ª–æ–≤ —á–µ—Ä–µ–∑ t.me/s/
- **–ì–∏–±—Ä–∏–¥–Ω–∞—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è** - embeddings + LLM –¥–ª—è –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è
- **Fallback —Å–∏—Å—Ç–µ–º–∞** - keyword-based –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –º–æ–¥–µ–ª–µ–π

## API

- `GET /api/v1/health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- `POST /api/v1/posts` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- **FastAPI** - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **sentence-transformers** - embeddings –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏  
- **scikit-learn** - –∞–ª–≥–æ—Ä–∏—Ç–º—ã –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
- **OpenAI** - LLM –¥–ª—è –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
- **httpx + BeautifulSoup** - –ø–∞—Ä—Å–∏–Ω–≥ Telegram 